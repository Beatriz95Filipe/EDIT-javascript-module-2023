<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Category_page</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <nav id="navbar" class="container--fluid">
        <a class="nav__logo" href=""><img src="assets/edit-extended-logo.png" alt="brand-logo"></a>
        <div class="nav__menu" id="categoriesNav">
            <a href="" class="menu__item">
                <span class="menu__item__label">Seating</span>
            </a>
            <a href="" class="menu__item">
                <span class="menu__item__label">Living Room</span>
            </a>
            <a href="" class="menu__item">
                <span class="menu__item__label">Outdoor</span>
            </a>
            <a href="" class="menu__item">
                <span class="menu__item__label">Bedroom</span>
            </a>
            <a href="" class="menu__item">
                <span class="menu__item__label">Storage</span>
            </a>
        </div>
    </nav>
    <aside></aside>
    <main>
        <p id="categoryTitle" class="category__title container">All Seating</p>
        <section class="container">
            <div class="row category__product__thumbnail" id="categoryProducts">
                <div class="col-lg-4 product__thumbnail">
                    <a href="./product.html">
                        <img class="main__img" src="assets/products/1/product.webp" alt="seating1">
                        <img class="hover__img" src="assets/products/1/product-hover.webp" alt="seating1h">
                    </a>
                    <p class="category__product__text">Nomad Sofa</p>
                    <p class="category__product__price">€1595 or as low as €100/mo</p>
                </div>
                <div class="col-lg-4 product__thumbnail">
                    <img class="main__img" src="assets/products/2/product.webp" alt="seating2">
                    <img class="hover__img" src="assets/products/2/product-hover.webp" alt="seating2h">
                    <p class="category__product__text">Nomad Sofa</p>
                    <p class="category__product__price">€1595 or as low as €100/mo</p>
                </div>
                <div class="col-lg-4 product__thumbnail">
                    <img class="main__img" src="assets/products/3/product.webp" alt="seating3">
                    <img class="hover__img" src="assets/products/3/product-hover.webp" alt="seating3h">
                    <p class="category__product__text">Nomad Sofa</p>
                    <p class="category__product__price">€1595 or as low as €100/mo</p>
                </div>
                <div class="col-lg-4 product__thumbnail">
                    <img class="main__img" src="assets/products/4/product.webp" alt="seating4">
                    <img class="hover__img" src="assets/products/4/product-hover.webp" alt="seating4h">
                    <p class="category__product__text">Nomad Sofa</p>
                    <p class="category__product__price">€1595 or as low as €100/mo</p>
                </div>
                <div class="col-lg-4 product__thumbnail">
                    <img class="main__img" src="assets/products/5/product.webp" alt="seating5">
                    <img class="hover__img" src="assets/products/5/product-hover.webp" alt="seating5h">
                    <p class="category__product__text">Nomad Sofa</p>
                    <p class="category__product__price">€1595 or as low as €100/mo</p>
                </div>
                <div class="col-lg-4 product__thumbnail">
                    <img class="main__img" src="assets/products/6/product.webp" alt="seating6">
                    <img class="hover__img" src="assets/products/6/product-hover.webp" alt="seating6h">
                    <p class="category__product__text">Nomad Sofa</p>
                    <p class="category__product__price">€1595 or as low as €100/mo</p>
                </div>
                <div class="col-lg-4 product__thumbnail">
                    <img class="main__img" src="assets/products/7/product.webp" alt="seating7">
                    <img class="hover__img" src="assets/products/7/product-hover.webp" alt="seating7h">
                    <p class="category__product__text">Nomad Sofa</p>
                    <p class="category__product__price">€1595 or as low as €100/mo</p>
                </div>
                <div class="col-lg-4 product__thumbnail">
                    <img class="main__img" src="assets/products/8/product.webp" alt="seating8">
                    <img class="hover__img" src="assets/products/8/product-hover.webp" alt="seating8h">
                    <p class="category__product__text">Nomad Sofa</p>
                    <p class="category__product__price">€1595 or as low as €100/mo</p>
                </div>
                <div class="col-lg-4 product__thumbnail">
                    <img class="main__img" src="assets/products/1/product.webp" alt="seating9">
                    <img class="hover__img" src="assets/products/1/product-hover.webp" alt="seating9h">
                    <p class="category__product__text">Nomad Sofa</p>
                    <p class="category__product__price">€1595 or as low as €100/mo</p>
                </div>
            </div>
        </section>
        <div class="row">
            <button class="btn__more">see more</button>
        </div>
        <div class="contact">
            <form id="subscribe" class="subscribe" action="">
                <input type="email" placeholder="Sign up for enthralling couch reads" name="emailField">
                <button class="btn__subscribe" type="submit">join our newsletter</button>
            </form>
            <div class="socials">
                <a class="socials_thumbnail" href="">
                    <img src="./assets/socials/icons8-youtube.svg" alt="youtube">
                </a>
                <a class="socials_thumbnail" href="">
                    <img src="./assets/socials/icons8-instagram.svg" alt="instagram">
                </a>
                <a class="socials_thumbnail" href="">
                    <img src="./assets/socials/icons8-facebook.svg" alt="facebook">
                </a>
            </div>
        </div>
    </main>
        <footer class="container--fluid footer">
            <div class="row footer__list">
                <div class="col-lg-3">
                    <ul>
                        <li class="title">Shopping Services</li>
                        <li><a class="footer__list" href="">Schedule Consultation</a></li>
                        <li><a class="footer__list" href="">Showrooms</a></li>
                        <li><a class="footer__list" href="">Trade Program</a></li>
                        <li><a class="footer__list" href="">Outlet</a></li>
                    </ul>
                </div>
                <div class="col-lg-3">
                    <ul>
                        <li class="title">About</li>
                        <li><a class="footer__list" href="">Our Story</a></li>
                        <li><a class="footer__list" href="">Reviews</a></li>
                        <li><a class="footer__list" href="">Careers</a></li>
                        <li><a class="footer__list" href="">Financing</a></li>
                        <li><a class="footer__list" href="">Patents</a></li>
                        <li><a class="footer__list" href="">Our Blog</a></li>
                    </ul>
                </div>
                <div class="col-lg-3">
                    <ul>
                        <li class="title">Resources</li>
                        <li><a class="footer__list" href="">Look Up Order Status</a></li>
                        <li><a class="footer__list" href="">Assembly Instructions</a></li>
                        <li><a class="footer__list" href="">Returns</a></li>
                        <li><a class="footer__list" href="">Shipping & Delivery</a></li>
                        <li><a class="footer__list" href="">FAQ</a></li>
                        <li><a class="footer__list" href="">Refer a Friend</a></li>
                    </ul>
                </div>
                <div class="col-lg-3">
                    <ul>
                        <li class="title">Contact Customer Experience</li>
                        <li>Email: support@template.com</li>
                        <li>Text: 224-628-7769</li>
                        <li>Hours:</li>
                        <li>Monday to Friday — 10a to 8p EST</li>
                        <li>Saturday to Sunday — 10a to 2p EST</li>
                    </ul>
                </div>
                <div class="col-lg-3"></div>
                <div class="col-lg-3"></div>
                <div class="col-lg-3"></div>
            </div>
            <div class="footer__end">
                <div class="copyright">
                    <p id="copyright">© 2023 Template</p>
                    <a class="site__links" href="">Terms</a>
                    <span> - </span>
                    <a class="site__links" href="">Accessibility</a>
                    <span> - </span>
                    <a class="site__links" href="">Sitemap</a>
                    <span> - </span>
                    <a class="site__links" href="">Privacy</a>
                </div>
                <div class="adress">
                    <p>15 W 27th Street, 9th Floor New York, NY, 10001</p>
                </div>
            </div>
        </footer>


        <script>

            const body = document.querySelector("body");

            async function getCategories(){
                let request = await fetch("https://fakestoreapi.com/products/categories");
                let categories = await request.json();
                return categories;
            }

            const getNavBarCategories = async () => {

                let categoriesNavBar = document.getElementById("categoriesNav");
                categoriesNavBar.innerHTML = "";

                let categories = await getCategories();
                //console.log(categories);

                categories.forEach((category) => {
                    categoriesNavBar.innerHTML +=
                        `<a href="./category.html?category=${category}" class="menu__item">
                            <span class="menu__item__label">${category}</span>
                        </a>`
                });
            }

            const urlCategory = new URLSearchParams (window.location.search);
            const clickedCategory = urlCategory.get("category");
            //console.log(clickedCategory);

            const categoryTitle = () => {
                let CapitalizedCategoryTitle = clickedCategory.charAt(0).toUpperCase() + clickedCategory.slice(1);
                //console.log(CapitalizedCategoryTitle);
                let categoriesTitle = document.getElementById("categoryTitle");
                categoriesTitle.innerHTML = "";
                categoriesTitle.innerHTML +=
                    `<p class="category__title">${CapitalizedCategoryTitle}</p>`;

            }

            async function getProductsByCategory(clickedCategory){
                let request = await fetch("https://fakestoreapi.com/products/category/"+clickedCategory);
                let products = await request.json();
                return products;
                //console.log(products);
            }

            const createCarousel = async () => {
                let products = await getProductsByCategory(clickedCategory);
                //console.log(products);

                let productsThumbnails = document.getElementById("categoryProducts");
                productsThumbnails.innerHTML = "";

                productsThumbnails.insertAdjacentHTML("beforebegin", 
                    // `<div class="bestRatedProducts" class="row">
                    //     <div id="productsCarousel"></div>
                    //     <div><p class="carouselSlogan">Shop our top items!</p></div>
                    // </div>`
                    `<section class="container--fluid">
                        <p class="carouselSlogan">Scroll our top items!</p>
                        <div id="productsCarousel" class="spaces"></div>
                    </section>`
                );

                let carouselContainer = document.getElementById("productsCarousel");
                let carouselProducts = products.filter((product) => product.rating.rate > 3);
                //console.log(carouselProducts);
                // let carouselImages = carouselProducts.filter((product) => product.image);
                // console.log(carouselImages);

                carouselProducts.forEach((product) => {
                    // const imgElement = document.createElement("img");
                    // imgElement.src = img.image;
                    // carouselContainer.append(imgElement);
                    carouselContainer.innerHTML +=
                    `<div class="spaces__thumbnail">
                        <a href=""><img src="${product.image}" alt="carousel-img"></a>
                    </div>`
                });
            }

            const createSearchBar = async () => {
                let products = await getProductsByCategory(clickedCategory);
                //console.log(products);

                let productDescription = products.map((product) => product.description.toLowerCase());
                let productTitle = products.map((product) => product.title.toLowerCase());
                

                let categoriesTitle = document.getElementById("categoryTitle");
                categoriesTitle.insertAdjacentHTML("afterend",
                    `<div class="searchProducts">
                        <input type="text" id="searchProductsInput" placeholder="Find your product" name="searchField">
                        <div id="searchResults" class="searchResults"></div>
                    </div>`
                );

                let searchProductsInput = document.getElementById("searchProductsInput");
                let searchResultsContainer = document.getElementById("searchResults");
                
                searchProductsInput.onkeyup = (searchInput) => {
                    let searchedProduct = searchInput.target.value.toLowerCase();
                    let matchingProducts = [];

                    for (let i = 0; i < products.length; i++) {
                        if (productTitle[i].includes(searchedProduct) || productDescription[i].includes(searchedProduct)) {
                            matchingProducts.push(products[i]);
                        }
                    }
                    displaySearchResults(matchingProducts, searchedProduct);
                }
            }

            const displaySearchResults = (matchingProducts, searchedProduct) => {
                let searchProductsInput = document.getElementById("searchProductsInput");

                let searchResultsContainer = document.getElementById("searchResults");
                searchResultsContainer.innerHTML = "";

                if (matchingProducts.length === 0) {
                    searchResultsContainer.innerHTML +=
                        `<div class="searchResultItem">
                            <p>It seems we can't find what you are looking for...</p>
                        </div>`;
                } else if (searchedProduct.length === 0) {
                    searchResultsContainer.innerHTML +=
                        `<div class="searchResultItem"></div>`;
                } else {
                    matchingProducts.forEach((product) => {
                    searchResultsContainer.innerHTML +=
                        `<div class="searchResultItem">
                            <p>${product.title}</p>
                            <img src="${product.image}">
                        </div>`;
                    });
                }
            }

            const createProductsGrid = async () => {
                let products = await getProductsByCategory(clickedCategory);
                //console.log(products);

                let productsThumbnails = document.getElementById("categoryProducts");
                productsThumbnails.innerHTML = "";

                products.forEach((product) => {

                let productId = product.id;
                let productDescription = product.description;
                let productImg = product.image;
                let productPrice = product.price;
                let productRating = product.rating;
                let productTitle = product.title;

                //console.log(product);
                //console.log(productId);

                productsThumbnails.innerHTML +=
                    `<div class="col-lg-4 product__thumbnail">
                        <a href="./product.html?productId=${productId}">
                            <img class="main__img" src="${productImg}" alt="${productTitle}">
                            <img class="hover__img" src="assets/shop-icon-thumbnail.JPG" alt="shop-icon">
                        </a>
                        <p class="category__product__text">${productTitle}</p>
                        <p class="category__product__price">€ ${productPrice}</p>
                    </div>`
                });
            }


            let copyrightFooter = () => {
                let getDate = new Date();
                let getYear = getDate.getFullYear();
                let copyrightYear = document.getElementById("copyright");
                copyrightYear.innerHTML = `<p>© ${getYear} Template</p>`;
                //console.log(getYear);
            }


            body.onload = () => {
                getNavBarCategories();
                categoryTitle();
                createCarousel();
                createSearchBar();
                createProductsGrid();
                copyrightFooter();
            }


            const newsletterForm = document.getElementById("subscribe");

            newsletterForm.onsubmit = (formSubmit) => {
                formSubmit.preventDefault();

                const newsletterData = new FormData(formSubmit.target);
                const email = newsletterData.get("emailField");
                console.log(email);

                fetch("https://fakeNewsletter.com", {
                    method: 'POST',
                    headers: {
                    'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(newsletterData)
                })
                    .then((response) => response.json())
                    .then((data) => {
                        console.log(data);
                        alert("Thank you for joining our newsletter!");
                    })
                    .catch(error => {
                        if (email === "") {
                        alert("Don't forget to enter you email!");
                        }
                    });
                
                newsletterForm.reset();
            }


        </script>
</body>
</html>